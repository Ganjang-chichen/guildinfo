<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/stylesheets/style.css">
</head>
<body>
    <header></header>
    <main>
        <div>
            <div>
                길드명
            </div>
            <div>
                <div id="chart_div" style="width: 100%; height: 300px;"></div>
            </div>
            <div class="guild_party_settings">
                <div class="guild_party">
                    <form action="">
                        <div>
                            <select name="" id="room_select" onchange="init_rade()">
                                <option value="01">1번방</option>
                                <option value="02">2번방</option>
                                <option value="03">3번방</option>
                                <option value="04">4번방</option>

                                <option value="05">5번방</option>
                                <option value="06">6번방</option>
                                <option value="07">7번방</option>
                                <option value="08">8번방</option>

                                <option value="09">9번방</option>
                                <option value="10">10번방</option>
                                <option value="11">11번방</option>
                                <option value="12">12번방</option>
                            </select>
                        </div>
                        <div class="guild_party_list">
                            <div class="guild_party1 partybox">
    
                            </div>
                            <div class="guild_party2 partybox">
    
                            </div>
                            <div class="guild_party3 partybox">
    
                            </div>
                            <div class="not_selected partybox">

                            </div>
                        </div>
                    </form>
                </div>

            </div>

        </div>
    </main>
    <footer>
        <script src="/javascripts/components/getdate.js"></script>
        <script>
            var char_list = "<%= JSON.stringify(char_list) %>"
            char_list = char_list.replaceAll('&#34;', '\"');
            char_list = JSON.parse(char_list);
            console.log(char_list);

            var guild_list = "<%= JSON.stringify(guild_info) %>"
            guild_list = guild_list.replaceAll('&#34;', '\"');
            guild_list = JSON.parse(guild_list);
            console.log(guild_list);
        </script>
        <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
        <script type="text/javascript">
            google.charts.load('current', {'packages':['corechart']});
            google.charts.setOnLoadCallback(drawChart);
            
            function getMindate(){
                var latest_date = '99991231';
                for(var i = 0; i < guild_list.length; i++){
                    var date = guild_list[i].input_date.split('T')[0].replaceAll('-','');
                    if(latest_date > date){
                        latest_date = date;
                    }
                }
                return latest_date;
            }

            function getMinRade(){
                var minrade = 10000000000;
                for(var i = 0; i < guild_list.length; i++){
                    var radep = guild_list[i].rade;
                    if(radep !== 0 && radep < minrade){
                        minrade = radep;
                    }
                }
                var digit = Math.floor(Math.log10(minrade));

                return Math.pow(10,digit);
                
            }

            function mk_graph_data(mindate) {
                var temp = [];
                var pasti = 0;
                while(true){
                    var week = getweek(pasti)[0]; // 0 일 1 월... 그러나 mysql 시간값이 미국꺼라 하루 빨리함

                    if(week.replaceAll('-','') < mindate){
                        break;
                    }

                    for(var i = 0; i < guild_list.length; i++){
                        var temp_week = guild_list[i].input_date.split('T')[0];
                        if(week === temp_week && guild_list[i].rade !== 0){
                            var temps = [temp_week, guild_list[i].rade];
                            temp.push(temps);
                            break;
                        }
                    }

                    pasti = pasti + 1;
                }
                var data = [['날짜', '점수']];
                for (var i = temp.length - 1; i >= 0 ; i--){
                    data.push(temp[i]);
                }

                return data;
            }
           
            function drawChart() {
                var data = google.visualization.arrayToDataTable(mk_graph_data(getMindate()));
                var options = {
                title: '길드 수로 점수',
                hAxis: {title: 'Year',  titleTextStyle: {color: '#333'}},
                vAxis: {minValue: getMinRade()}
                };
        
                var chart = new google.visualization.AreaChart(document.getElementById('chart_div'));
                chart.draw(data, options);
            }
        </script>
        <script src="/javascripts/screens/radepage.js"></script>
    </footer>
</body>
</html>